{"version":3,"file":"uuw-litemol-component.js","sources":["../node_modules/style-inject/dist/style-inject.es.js","../src/uuw-litemol-component.js","../src/main.js"],"sourcesContent":["function styleInject(css, ref) {\n  if ( ref === void 0 ) ref = {};\n  var insertAt = ref.insertAt;\n\n  if (!css || typeof document === 'undefined') { return; }\n\n  var head = document.head || document.getElementsByTagName('head')[0];\n  var style = document.createElement('style');\n  style.type = 'text/css';\n\n  if (insertAt === 'top') {\n    if (head.firstChild) {\n      head.insertBefore(style, head.firstChild);\n    } else {\n      head.appendChild(style);\n    }\n  } else {\n    head.appendChild(style);\n  }\n\n  if (style.styleSheet) {\n    style.styleSheet.cssText = css;\n  } else {\n    style.appendChild(document.createTextNode(css));\n  }\n}\n\nexport default styleInject;\n","import '../style/style.css';\n\nclass UuwLitemolComponent extends HTMLElement {\n\n    constructor() {\n        super();\n        this._loaded = false;\n        this._mappings = [];\n        this._highlightstart = parseInt(this.getAttribute('highlightstart'));\n        this._highlightend = parseInt(this.getAttribute('highlightend'));\n        this.loadMolecule = this\n            .loadMolecule\n            .bind(this);\n        this.loadStructureTable = this\n            .loadStructureTable\n            .bind(this);\n    }\n\n    get accession() {\n        return this.getAttribute('accession');\n    }\n\n    set accession(accession) {\n        return this.setAttribute('accession', accession);\n    }\n\n    connectedCallback() {\n        this.titleContainer = document.createElement('h4');\n        this.titleContainer.id = 'litemol-title';\n        this.tableDiv = document.createElement('div');\n        this.tableDiv.className = 'table-container';\n        const litemolDiv = document.createElement('div');\n        litemolDiv.className = 'litemol-container';\n        litemolDiv.id = 'app';\n        this.appendChild(this.titleContainer);\n        this.appendChild(litemolDiv);\n        this.appendChild(this.tableDiv);\n        this.loadLiteMol();\n        this\n            .loadUniProtEntry()\n            .then(entry => {\n                this._pdbEntries = entry\n                    .dbReferences\n                    .filter(dbref => dbref.type === 'PDB');\n                this.loadStructureTable();\n                this.selectMolecule(this._pdbEntries[0].id);\n            });\n    }\n\n    static get observedAttributes() {\n        return ['highlightstart', 'highlightend'];\n    }\n\n    get isManaged() {\n        return true;\n    }\n\n    attributeChangedCallback(attrName, oldVal, newVal) {\n        if (oldVal !== newVal) {\n            const value = parseInt(newVal);\n            this[`_${attrName}`] = isNaN(value) ? newVal : value;\n            this.highlightChain();\n        }\n    }\n\n    async loadUniProtEntry() {\n        try {\n            return await (await fetch(`https://www.ebi.ac.uk/proteins/api/proteins/${this.accession}`)).json();\n        } catch (e) {\n            throw new Error(`Couldn't load UniProt entry`, e);\n        }\n    }\n\n    async loadPDBEntry(pdbId) {\n        try {\n            return await (await fetch(`http://www.ebi.ac.uk/pdbe/api/mappings/uniprot/${pdbId}`)).json();\n        } catch (e) {\n            throw new Error(`Couldn't load PDB entry`, e);\n        }\n    }\n\n\n    loadStructureTable() {\n        const html = `\n            <table>\n                <thead>\n                    <th>PDB Entry</th>\n                    <th>Method</th>\n                    <th>Resolution</th>\n                    <th>Chain</th>\n                    <th>Positions</th>\n                    <th>Links</th>\n                </thead>\n                <tbody>\n                    ${this._pdbEntries\n            .map(d => `\n                        <tr id=\"${d.id}\" class=\"pdb-row\">\n                            <td>\n                            <strong>${d.id}</strong><br/>\n                            </td>\n                            <td>${d.properties.method}</td>\n                            <td>${this.formatAngstrom(d.properties.resolution)}</td>\n                            <td title=\"${this.getChain(d.properties.chains)}\">${this.getChain(d.properties.chains)}</td>\n                            <td>${this.getPositions(d.properties.chains)}</td>\n                            <td>\n                                <a target=\"_blank\" href=\"//www.ebi.ac.uk/pdbe/entry/pdb/${d.id}\">PDB</a> \n                                <a target=\"_blank\" href=\"//www.rcsb.org/pdb/explore/explore.do?pdbId=${d.id}\">RCSB-PDBi</a>\n                                <a target=\"_blank\" href=\"//pdbj.org/mine/summary/${d.id}\">PDBj</a>\n                                <a target=\"_blank\" href=\"//www.ebi.ac.uk/thornton-srv/databases/cgi-bin/pdbsum/GetPage.pl?pdbcode=${d.id}\">PDBSUM</a>\n                            </td>\n                        </tr>\n                    `)\n            .join('')}\n                </tbody>\n            </table>\n        `;\n        this.tableDiv.innerHTML = html;\n        this\n            .querySelectorAll('.pdb-row')\n            .forEach(row => row.addEventListener('click', (e) => this.selectMolecule(row.id)));\n    }\n\n    getChain(chains) {\n        return chains.split('=')[0];\n    }\n\n    getPositions(chains) {\n        return chains.split('=')[1];\n    }\n\n    get isManaged() {\n        return true;\n    }\n\n    selectMolecule(id) {\n        this\n            .querySelectorAll('.active')\n            .forEach(row => row.classList.remove('active'));\n        document\n            .getElementById(id)\n            .classList\n            .add('active');\n        document.getElementById('litemol-title').textContent = id;\n        this.loadMolecule(id);\n        this.loadMappingContext(id);\n    }\n\n    loadLiteMol() {\n        const Plugin = LiteMol.Plugin;\n        this.Command = LiteMol.Bootstrap.Command;\n        this.Query = LiteMol.Core.Structure.Query;\n        this.Bootstrap = LiteMol.Bootstrap;\n        this.Core = LiteMol.Core;\n        this.Tree = this.Bootstrap.Tree;\n        this.CoreVis = LiteMol.Visualization;\n        this.Transformer = this.Bootstrap.Entity.Transformer;\n        this.Visualization = this.Bootstrap.Visualization;\n        this.Event = this.Bootstrap.Event;\n        // Plugin.Components.Context.Log(this.Bootstrap.Components.LayoutRegion.Bottom, true);\n        this._liteMol = Plugin.create({\n            target: '#app',\n            viewportBackground: '#fff',\n            layoutState: {\n                hideControls: true\n            },\n            allowAnalytics: false\n        });\n    }\n\n    loadMolecule(_id) {\n        this._loaded = false;\n\n        this\n            ._liteMol\n            .clear();\n\n        let transform = this._liteMol.createTransform();\n\n        transform.add(this\n                ._liteMol.root, this.Transformer.Data.Download, {\n                    url: `https://www.ebi.ac.uk/pdbe/coordinates/${_id.toLowerCase()}/full?encoding=BCIF`,\n                    type: 'Binary',\n                    _id\n                })\n            .then(this.Transformer.Data.ParseBinaryCif, {\n                id: _id\n            }, {\n                isBinding: true,\n                ref: 'cifDict'\n            })\n            .then(this.Transformer.Molecule.CreateFromMmCif, {\n                blockIndex: 0\n            }, {\n                isBinding: true\n            })\n            .then(this.Transformer.Molecule.CreateModel, {\n                modelIndex: 0\n            }, {\n                isBinding: false,\n                ref: 'model'\n            })\n            .then(this.Transformer.Molecule.CreateMacromoleculeVisual, {\n                polymer: true,\n                polymerRef: 'polymer-visual',\n                het: true,\n                water: true\n            });\n\n        this\n            ._liteMol.applyTransform(transform).then(() => {\n                this._loaded = true;\n                this.highlightChain();\n            });\n    }\n\n    getTheme() {\n        let colors = new Map();\n        colors.set('Uniform', this.CoreVis.Color.fromRgb(207, 178, 178));\n        colors.set('Selection', this.CoreVis.Color.fromRgb(255, 255, 0));\n        colors.set('Highlight', this.CoreVis.Theme.Default.HighlightColor);\n        return this.Visualization.Molecule.uniformThemeProvider(void 0, {\n            colors: colors\n        });\n    }\n\n    processMapping(id, mappingData) {\n        if (!Object.values(mappingData)[0].UniProt[this.accession])\n            return;\n        this._mappings = Object.values(mappingData)[0].UniProt[this.accession].mappings;\n    }\n\n    translatePositions(start, end) {\n        for (const mapping of this._mappings) {\n            console.log(`UP ${mapping.unp_start}-${mapping.unp_end}`);\n            console.log(`PDB ${mapping.start.residue_number}-${mapping.end.residue_number}`);\n            if (mapping.unp_end - mapping.unp_start === mapping.end.residue_number - mapping.start.residue_number) {\n                if (start >= mapping.unp_start && end <= mapping.unp_end) {\n                    const offset = mapping.unp_start - mapping.start.residue_number;\n                    //TODO this is wrong because there are gaps in the PDB sequence\n                    return {\n                        entity: mapping.entity_id,\n                        chain: mapping.chain_id,\n                        start: (start - offset),\n                        end: (end - offset)\n                    }\n                } else {\n                    console.log('Positions not found in this structure');\n                    return;\n                }\n            } else {\n                console.log('Non-exact mapping');\n                return;\n            }\n        }\n    }\n\n    loadMappingContext(id) {\n        this.loadPDBEntry(id).then(d => {\n            this.processMapping(id, d);\n        });\n    }\n\n    highlightChain() {\n        if (!this._loaded || !this._highlightstart || !this._highlightend)\n            return;\n\n        this.Command.Visual.ResetTheme.dispatch(this._liteMol.context, void 0);\n        this.Command.Tree.RemoveNode.dispatch(this._liteMol.context, 'sequence-selection');\n\n        const visual = this._liteMol.context.select('polymer-visual')[0];\n        if (!visual)\n            return;\n\n        const translatedPos = this.translatePositions(this._highlightstart, this._highlightend);\n        if (!translatedPos)\n            return;\n\n        const query = this.Query.sequence(translatedPos.entity.toString(), translatedPos.chain, {\n            seqNumber: translatedPos.start\n        }, {\n            seqNumber: translatedPos.end\n        });\n\n        const theme = this.getTheme();\n\n        const action = this._liteMol.createTransform()\n            .add(visual, this.Transformer.Molecule.CreateSelectionFromQuery, {\n                query: query,\n                name: 'My name'\n            }, {\n                ref: 'sequence-selection'\n            });\n\n        this._liteMol.applyTransform(action).then(() => {\n            this.Command.Visual.UpdateBasicTheme.dispatch(this._liteMol.context, {\n                visual: visual,\n                theme: theme\n            });\n            this.Command.Entity.Focus.dispatch(this._liteMol.context, this._liteMol.context.select('sequence-selection'));\n        });\n    }\n\n    findMoleculeWithinRange(start, end) {\n\n    }\n\n    formatAngstrom(val) {\n        if (!val)\n            return;\n        return val.replace('A', '&#8491;');\n    }\n\n}\n\nexport default UuwLitemolComponent;","import UuwLitemolComponent from './uuw-litemol-component';\n\nconst loadComponent = function () {\n    customElements.define('uuw-litemol-component', UuwLitemolComponent);\n}\n\n// Conditional loading of polyfill\nif (window.customElements) {\n    loadComponent();\n} else {\n    document\n        .addEventListener('WebComponentsReady', function () {\n            loadComponent();\n        });\n}"],"names":["UuwLitemolComponent","_loaded","_mappings","_highlightstart","parseInt","getAttribute","_highlightend","loadMolecule","bind","loadStructureTable","titleContainer","document","createElement","id","tableDiv","className","litemolDiv","appendChild","loadLiteMol","loadUniProtEntry","then","_pdbEntries","entry","dbReferences","filter","dbref","type","selectMolecule","attrName","oldVal","newVal","value","isNaN","highlightChain","fetch","accession","json","Error","pdbId","html","map","d","properties","method","formatAngstrom","resolution","getChain","chains","getPositions","join","innerHTML","querySelectorAll","forEach","row","addEventListener","e","split","classList","remove","getElementById","add","textContent","loadMappingContext","Plugin","LiteMol","Command","Bootstrap","Query","Core","Structure","Tree","CoreVis","Visualization","Transformer","Entity","Event","_liteMol","create","_id","clear","transform","createTransform","root","Data","Download","toLowerCase","ParseBinaryCif","Molecule","CreateFromMmCif","CreateModel","CreateMacromoleculeVisual","applyTransform","colors","Map","set","Color","fromRgb","Theme","Default","HighlightColor","uniformThemeProvider","mappingData","Object","values","UniProt","mappings","start","end","mapping","log","unp_start","unp_end","residue_number","offset","entity_id","chain_id","loadPDBEntry","processMapping","Visual","ResetTheme","dispatch","context","RemoveNode","visual","select","translatedPos","translatePositions","query","sequence","entity","toString","chain","theme","getTheme","action","CreateSelectionFromQuery","UpdateBasicTheme","Focus","val","replace","setAttribute","HTMLElement","loadComponent","define","window","customElements"],"mappings":"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"}