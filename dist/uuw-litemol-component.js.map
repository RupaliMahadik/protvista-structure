{"version":3,"file":"uuw-litemol-component.js","sources":["../src/main.js"],"sourcesContent":["const loadComponent = function () {\n    class UuwLitemolComponent extends HTMLElement {\n\n        constructor() {\n            super();\n            this._loaded = false;\n            this._mappings = [];\n            this._highlightstart = parseInt(this.getAttribute('highlightstart'));\n            this._highlightend = parseInt(this.getAttribute('highlightend'));\n            this.loadMolecule = this\n                .loadMolecule\n                .bind(this);\n            this.loadStructureTable = this\n                .loadStructureTable\n                .bind(this);\n            const styleTag = document.createElement('style');\n            this.appendChild(styleTag);\n            styleTag.innerHTML = `\n                :root {\n                    --blue: 0,112,155;\n                    --width: 100%;\n                }\n                uuw-litemol-component {\n                    display:flex;\n                }\n                .litemol-container, .table-container {\n                    width: var(--width);\n                    height: 480px;\n                    position: relative;\n                }\n                .table-container table {\n                    display:flex;\n                    flex-flow:column;\n                    width:100%;\n                    height: 480px;\n                    border-collapse: collapse;\n                }\n                .table-container thead {\n                    min-height: 3em;\n                    flex: 0 0 auto;\n                    width: 100%;\n                }\n\n                .table-container tbody {\n                    flex: 1 1 auto;\n                    display:block;\n                    overflow-y: scroll;\n                    border:none;\n                }\n                \n                .table-container tbody tr {\n                    width:100%;\n                    cursor: pointer;\n                }\n\n                .table-container thead, .table-container tbody tr {\n                    display: table;\n                    table-layout: fixed;\n                }\n\n                .table-container tbody tr:hover {\n                    background-color: rgba(var(--blue), 0.15);;\n                }\n                .table-container tr.active {\n                    background-color: rgba(var(--blue), 0.3);;\n                }\n            `;\n        }\n\n        get accession() {\n            return this.getAttribute('accession');\n        }\n\n        set accession(accession) {\n            return this.setAttribute('accession', accession);\n        }\n\n        connectedCallback() {\n            this.titleContainer = document.createElement('h4');\n            this.titleContainer.id = 'litemol-title';\n            this.tableDiv = document.createElement('div');\n            this.tableDiv.className = 'table-container';\n            const litemolDiv = document.createElement('div');\n            litemolDiv.className = 'litemol-container';\n            litemolDiv.id = 'app';\n            this.appendChild(this.titleContainer);\n            this.appendChild(litemolDiv);\n            this.appendChild(this.tableDiv);\n            this.loadLiteMol();\n            this\n                .loadUniProtEntry()\n                .then(entry => {\n                    const pdbEntries = entry\n                        .dbReferences\n                        .filter(dbref => dbref.type === 'PDB');\n                    this.loadStructureTable(pdbEntries);\n                    this.selectMolecule(pdbEntries[0].id);\n                });\n        }\n\n        static get observedAttributes() {\n            return ['highlightstart', 'highlightend'];\n        }\n\n        get isManaged() {\n            return true;\n        }\n\n        attributeChangedCallback(attrName, oldVal, newVal) {\n            if (oldVal !== newVal) {\n                const value = parseInt(newVal);\n                this[`_${attrName}`] = isNaN(value) ? newVal : value;\n                this.highlightChain();\n            }\n        }\n\n        async loadUniProtEntry() {\n            try {\n                return await (await fetch(`https://www.ebi.ac.uk/proteins/api/proteins/${this.accession}`)).json();\n            } catch (e) {\n                throw new Error(`Couldn't load UniProt entry`, e);\n            }\n        }\n\n        async loadPDBEntry(pdbId) {\n            try {\n                return await (await fetch(`http://www.ebi.ac.uk/pdbe/api/mappings/uniprot/${pdbId}`)).json();\n            } catch (e) {\n                throw new Error(`Couldn't load PDB entry`, e);\n            }\n        }\n\n\n        loadStructureTable(pdbEntries) {\n            const html = `\n                <table>\n                    <thead>\n                        <th>PDB Entry</th>\n                        <th>Method</th>\n                        <th>Resolution</th>\n                        <th>Chain</th>\n                        <th>Positions</th>\n                        <th>Links</th>\n                    </thead>\n                    <tbody>\n                        ${pdbEntries\n                .map(d => `\n                            <tr id=\"${d.id}\" class=\"pdb-row\">\n                                <td>\n                                <strong>${d.id}</strong><br/>\n                                </td>\n                                <td>${d.properties.method}</td>\n                                <td>${this.formatAngstrom(d.properties.resolution)}</td>\n                                <td title=\"${this.getChain(d.properties.chains)}\">${this.getChain(d.properties.chains)}</td>\n                                <td>${this.getPositions(d.properties.chains)}</td>\n                                <td>\n                                    <a target=\"_blank\" href=\"//www.ebi.ac.uk/pdbe/entry/pdb/${d.id}\">PDB</a> \n                                    <a target=\"_blank\" href=\"//www.rcsb.org/pdb/explore/explore.do?pdbId=${d.id}\">RCSB-PDBi</a>\n                                    <a target=\"_blank\" href=\"//pdbj.org/mine/summary/${d.id}\">PDBj</a>\n                                    <a target=\"_blank\" href=\"//www.ebi.ac.uk/thornton-srv/databases/cgi-bin/pdbsum/GetPage.pl?pdbcode=${d.id}\">PDBSUM</a>\n                                </td>\n                            </tr>\n                        `)\n                .join('')}\n                    </tbody>\n                </table>\n            `;\n            this.tableDiv.innerHTML = html;\n            this\n                .querySelectorAll('.pdb-row')\n                .forEach(row => row.addEventListener('click', (e) => this.selectMolecule(row.id)));\n        }\n\n        getChain(chains) {\n            return chains.split('=')[0];\n        }\n\n        getPositions(chains) {\n            return chains.split('=')[1];\n        }\n\n        get isManaged() {\n            return true;\n        }\n\n        selectMolecule(id) {\n            this\n                .querySelectorAll('.active')\n                .forEach(row => row.classList.remove('active'));\n            document\n                .getElementById(id)\n                .classList\n                .add('active');\n            document.getElementById('litemol-title').textContent = id;\n            this.loadMolecule(id);\n            this.loadMappingContext(id);\n        }\n\n        loadLiteMol() {\n            const Plugin = LiteMol.Plugin;\n            this.Command = LiteMol.Bootstrap.Command;\n            this.Query = LiteMol.Core.Structure.Query;\n            this.Bootstrap = LiteMol.Bootstrap;\n            this.Core = LiteMol.Core;\n            this.Tree = this.Bootstrap.Tree;\n            this.CoreVis = LiteMol.Visualization;\n            this.Transformer = this.Bootstrap.Entity.Transformer;\n            this.Visualization = this.Bootstrap.Visualization;\n            this.Event = this.Bootstrap.Event;\n            // Plugin.Components.Context.Log(this.Bootstrap.Components.LayoutRegion.Bottom, true);\n            this._liteMol = Plugin.create({\n                target: '#app',\n                viewportBackground: '#fff',\n                layoutState: {\n                    hideControls: true\n                },\n                allowAnalytics: false\n            });\n        }\n\n        loadMolecule(_id) {\n            this._loaded = false;\n\n            this\n                ._liteMol\n                .clear();\n\n            let transform = this._liteMol.createTransform();\n\n            transform.add(this\n                    ._liteMol.root, this.Transformer.Data.Download, {\n                        url: `https://www.ebi.ac.uk/pdbe/coordinates/${_id.toLowerCase()}/full?encoding=BCIF`,\n                        type: 'Binary',\n                        _id\n                    })\n                .then(this.Transformer.Data.ParseBinaryCif, {\n                    id: _id\n                }, {\n                    isBinding: true,\n                    ref: 'cifDict'\n                })\n                .then(this.Transformer.Molecule.CreateFromMmCif, {\n                    blockIndex: 0\n                }, {\n                    isBinding: true\n                })\n                .then(this.Transformer.Molecule.CreateModel, {\n                    modelIndex: 0\n                }, {\n                    isBinding: false,\n                    ref: 'model'\n                })\n                .then(this.Transformer.Molecule.CreateMacromoleculeVisual, {\n                    polymer: true,\n                    polymerRef: 'polymer-visual',\n                    het: true,\n                    water: true\n                });\n\n            this\n                ._liteMol.applyTransform(transform).then(() => {\n                    this._loaded = true;\n                    this.highlightChain();\n                });\n        }\n\n        getTheme() {\n            let colors = new Map();\n            colors.set('Uniform', this.CoreVis.Color.fromRgb(207, 178, 178));\n            colors.set('Selection', this.CoreVis.Color.fromRgb(255, 255, 0));\n            colors.set('Highlight', this.CoreVis.Theme.Default.HighlightColor);\n            return this.Visualization.Molecule.uniformThemeProvider(void 0, {\n                colors: colors\n            });\n        }\n\n        processMapping(id, mappingData) {\n            if (!Object.values(mappingData)[0].UniProt[this.accession])\n                return;\n            this._mappings = Object.values(mappingData)[0].UniProt[this.accession].mappings;\n        }\n\n        translatePositions(start, end) {\n            for (const mapping of this._mappings) {\n                console.log(`UP ${mapping.unp_start}-${mapping.unp_end}`);\n                console.log(`PDB ${mapping.start.residue_number}-${mapping.end.residue_number}`);\n                if (mapping.unp_end - mapping.unp_start === mapping.end.residue_number - mapping.start.residue_number) {\n                    if (start >= mapping.unp_start && end <= mapping.unp_end) {\n                        const offset = mapping.unp_start - mapping.start.residue_number;\n                        //TODO this is wrong because there are gaps in the PDB sequence\n                        return {\n                            entity: mapping.entity_id,\n                            chain: mapping.chain_id,\n                            start: (start - offset),\n                            end: (end - offset)\n                        }\n                    } else {\n                        console.log('Positions not found in this structure');\n                        return;\n                    }\n                } else {\n                    console.log('Non-exact mapping');\n                    return;\n                }\n            }\n        }\n\n        loadMappingContext(id) {\n            this.loadPDBEntry(id).then(d => {\n                this.processMapping(id, d);\n            });\n        }\n\n        highlightChain() {\n            if (!this._loaded || !this._highlightstart || !this._highlightend)\n                return;\n\n            this.Command.Visual.ResetTheme.dispatch(this._liteMol.context, void 0);\n            this.Command.Tree.RemoveNode.dispatch(this._liteMol.context, 'sequence-selection');\n\n            const visual = this._liteMol.context.select('polymer-visual')[0];\n            if (!visual)\n                return;\n\n            const translatedPos = this.translatePositions(this._highlightstart, this._highlightend);\n            if (!translatedPos)\n                return;\n\n            const query = this.Query.sequence(translatedPos.entity.toString(), translatedPos.chain, {\n                seqNumber: translatedPos.start\n            }, {\n                seqNumber: translatedPos.end\n            });\n\n            const theme = this.getTheme();\n\n            const action = this._liteMol.createTransform()\n                .add(visual, this.Transformer.Molecule.CreateSelectionFromQuery, {\n                    query: query,\n                    name: 'My name'\n                }, {\n                    ref: 'sequence-selection'\n                });\n\n            this._liteMol.applyTransform(action).then(() => {\n                this.Command.Visual.UpdateBasicTheme.dispatch(this._liteMol.context, {\n                    visual: visual,\n                    theme: theme\n                });\n                this.Command.Entity.Focus.dispatch(this._liteMol.context, this._liteMol.context.select('sequence-selection'));\n            });\n        }\n\n        formatAngstrom(val) {\n            if (!val)\n                return;\n            return val.replace('A', '&#8491;');\n        }\n\n    }\n    customElements.define('uuw-litemol-component', UuwLitemolComponent);\n}\n\n// Conditional loading of polyfill\nif (window.customElements) {\n    loadComponent();\n} else {\n    document\n        .addEventListener('WebComponentsReady', function () {\n            loadComponent();\n        });\n}"],"names":["loadComponent","UuwLitemolComponent","_loaded","_mappings","_highlightstart","parseInt","getAttribute","_highlightend","loadMolecule","bind","loadStructureTable","styleTag","document","createElement","appendChild","innerHTML","titleContainer","id","tableDiv","className","litemolDiv","loadLiteMol","loadUniProtEntry","then","pdbEntries","entry","dbReferences","filter","dbref","type","selectMolecule","attrName","oldVal","newVal","value","isNaN","highlightChain","fetch","accession","json","Error","pdbId","html","map","d","properties","method","formatAngstrom","resolution","getChain","chains","getPositions","join","querySelectorAll","forEach","row","addEventListener","e","split","classList","remove","getElementById","add","textContent","loadMappingContext","Plugin","LiteMol","Command","Bootstrap","Query","Core","Structure","Tree","CoreVis","Visualization","Transformer","Entity","Event","_liteMol","create","_id","clear","transform","createTransform","root","Data","Download","toLowerCase","ParseBinaryCif","Molecule","CreateFromMmCif","CreateModel","CreateMacromoleculeVisual","applyTransform","colors","Map","set","Color","fromRgb","Theme","Default","HighlightColor","uniformThemeProvider","mappingData","Object","values","UniProt","mappings","start","end","mapping","log","unp_start","unp_end","residue_number","offset","entity_id","chain_id","loadPDBEntry","processMapping","Visual","ResetTheme","dispatch","context","RemoveNode","visual","select","translatedPos","translatePositions","query","sequence","entity","toString","chain","theme","getTheme","action","CreateSelectionFromQuery","UpdateBasicTheme","Focus","val","replace","setAttribute","HTMLElement","define","window","customElements"],"mappings":"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"}