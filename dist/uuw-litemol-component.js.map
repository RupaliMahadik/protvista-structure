{"version":3,"file":"uuw-litemol-component.js","sources":["../node_modules/style-inject/dist/style-inject.es.js","../src/uuw-litemol-component.js","../src/main.js"],"sourcesContent":["function styleInject(css, ref) {\n  if ( ref === void 0 ) ref = {};\n  var insertAt = ref.insertAt;\n\n  if (!css || typeof document === 'undefined') { return; }\n\n  var head = document.head || document.getElementsByTagName('head')[0];\n  var style = document.createElement('style');\n  style.type = 'text/css';\n\n  if (insertAt === 'top') {\n    if (head.firstChild) {\n      head.insertBefore(style, head.firstChild);\n    } else {\n      head.appendChild(style);\n    }\n  } else {\n    head.appendChild(style);\n  }\n\n  if (style.styleSheet) {\n    style.styleSheet.cssText = css;\n  } else {\n    style.appendChild(document.createTextNode(css));\n  }\n}\n\nexport default styleInject;\n","import '../style/style.css';\n\nclass UuwLitemolComponent extends HTMLElement {\n\n    constructor() {\n        super();\n        this._loaded = false;\n        this._mappings = [];\n        this._highlightstart = parseInt(this.getAttribute('highlightstart'));\n        this._highlightend = parseInt(this.getAttribute('highlightend'));\n        this.loadMolecule = this\n            .loadMolecule\n            .bind(this);\n        this.loadStructureTable = this\n            .loadStructureTable\n            .bind(this);\n    }\n\n    get accession() {\n        return this.getAttribute('accession');\n    }\n\n    set accession(accession) {\n        return this.setAttribute('accession', accession);\n    }\n\n    connectedCallback() {\n        this.titleContainer = document.createElement('h4');\n        this.titleContainer.id = 'litemol-title';\n        this.tableDiv = document.createElement('div');\n        this.tableDiv.className = 'table-container';\n        const litemolDiv = document.createElement('div');\n        litemolDiv.className = 'litemol-container';\n        litemolDiv.id = 'app';\n        this.appendChild(this.titleContainer);\n        this.appendChild(litemolDiv);\n        this.appendChild(this.tableDiv);\n        this.loadLiteMol();\n        this\n            .loadUniProtEntry()\n            .then(entry => {\n                this._pdbEntries = entry\n                    .dbReferences\n                    .filter(dbref => dbref.type === 'PDB')\n                    .map(d => {\n                        return {\n                            id: d.id,\n                            properties: {\n                                method: d.properties.method,\n                                chains: this.getChain(d.properties.chains),\n                                start: this.getStart(d.properties.chains),\n                                end:  this.getEnd(d.properties.chains)\n                            }\n                        }\n                    });\n                this.loadStructureTable();\n                this.selectMolecule(this._pdbEntries[0].id);\n            });\n    }\n\n    static get observedAttributes() {\n        return ['highlightstart', 'highlightend'];\n    }\n\n    get isManaged() {\n        return true;\n    }\n\n    attributeChangedCallback(attrName, oldVal, newVal) {\n        if (oldVal !== newVal) {\n            const value = parseInt(newVal);\n            this[`_${attrName}`] = isNaN(value) ? newVal : value;\n            this._selectMoleculeWithinRange(this._highlightstart, this._highlightend);\n            this.highlightChain();\n        }\n    }\n\n    async loadUniProtEntry() {\n        try {\n            return await (await fetch(`https://www.ebi.ac.uk/proteins/api/proteins/${this.accession}`)).json();\n        } catch (e) {\n            throw new Error(`Couldn't load UniProt entry`, e);\n        }\n    }\n\n    async loadPDBEntry(pdbId) {\n        try {\n            return await (await fetch(`https://www.ebi.ac.uk/pdbe/api/mappings/uniprot/${pdbId}`)).json();\n        } catch (e) {\n            throw new Error(`Couldn't load PDB entry`, e);\n        }\n    }\n\n\n    loadStructureTable() {\n        const html = `\n            <table>\n                <thead>\n                    <th>PDB Entry</th>\n                    <th>Method</th>\n                    <th>Resolution</th>\n                    <th>Chain</th>\n                    <th>Positions</th>\n                    <th>Links</th>\n                </thead>\n                <tbody>\n                    ${this._pdbEntries\n            .map(d => `\n                        <tr id=\"entry_${d.id}\" class=\"pdb-row\">\n                            <td>\n                            <strong>${d.id}</strong><br/>\n                            </td>\n                            <td>${d.properties.method}</td>\n                            <td>${this.formatAngstrom(d.properties.resolution)}</td>\n                            <td title=\"${d.properties.chains}\">${d.properties.chains}</td>\n                            <td>${d.properties.start}-${d.properties.end}</td>\n                            <td>\n                                <a target=\"_blank\" href=\"//www.ebi.ac.uk/pdbe/entry/pdb/${d.id}\">PDB</a><br> \n                                <a target=\"_blank\" href=\"//www.rcsb.org/pdb/explore/explore.do?pdbId=${d.id}\">RCSB-PDBi</a><br>\n                                <a target=\"_blank\" href=\"//pdbj.org/mine/summary/${d.id}\">PDBj</a><br>\n                                <a target=\"_blank\" href=\"//www.ebi.ac.uk/thornton-srv/databases/cgi-bin/pdbsum/GetPage.pl?pdbcode=${d.id}\">PDBSUM</a>\n                            </td>\n                        </tr>\n                    `)\n            .join('')}\n                </tbody>\n            </table>\n        `;\n        this.tableDiv.innerHTML = html;\n        this\n            .querySelectorAll('.pdb-row')\n            .forEach(row => row.addEventListener('click', (e) => this.selectMolecule(row.id.replace('entry_', ''))));\n    }\n\n    getChain(chains) {\n        return chains.split('=')[0];\n    }\n\n    getStart(chains) {\n        return chains.split('=')[1].split('-')[0];\n    }\n\n    getEnd(chains) {\n        return chains.split('=')[1].split('-')[1];\n    }\n\n    get isManaged() {\n        return true;\n    }\n\n    async selectMolecule(id) {\n        this.loadPDBEntry(id).then(d => {\n            const mappings = this.processMapping(d);\n            this._selectedMolecule = {\n                'id': id,\n                'mappings': mappings\n            };\n            this\n                .querySelectorAll('.active')\n                .forEach(row => row.classList.remove('active'));\n            this\n                .querySelector(`#entry_${id}`)\n                .classList\n                .add('active');\n            this.querySelector('#litemol-title').textContent = id;\n            this.loadMolecule(id);\n        });\n    }\n\n    loadLiteMol() {\n        const Plugin = LiteMol.Plugin;\n        this.Command = LiteMol.Bootstrap.Command;\n        this.Query = LiteMol.Core.Structure.Query;\n        this.Bootstrap = LiteMol.Bootstrap;\n        this.Core = LiteMol.Core;\n        this.Tree = this.Bootstrap.Tree;\n        this.CoreVis = LiteMol.Visualization;\n        this.Transformer = this.Bootstrap.Entity.Transformer;\n        this.Visualization = this.Bootstrap.Visualization;\n        this.Event = this.Bootstrap.Event;\n        // Plugin.Components.Context.Log(this.Bootstrap.Components.LayoutRegion.Bottom, true);\n        this._liteMol = Plugin.create({\n            target: '#app',\n            viewportBackground: '#fff',\n            layoutState: {\n                hideControls: true\n            },\n            allowAnalytics: false\n        });\n    }\n\n    loadMolecule(_id) {\n        this._loaded = false;\n\n        this\n            ._liteMol\n            .clear();\n\n        let transform = this._liteMol.createTransform();\n\n        transform.add(this\n                ._liteMol.root, this.Transformer.Data.Download, {\n                    url: `https://www.ebi.ac.uk/pdbe/coordinates/${_id.toLowerCase()}/full?encoding=BCIF`,\n                    type: 'Binary',\n                    _id\n                })\n            .then(this.Transformer.Data.ParseBinaryCif, {\n                id: _id\n            }, {\n                isBinding: true,\n                ref: 'cifDict'\n            })\n            .then(this.Transformer.Molecule.CreateFromMmCif, {\n                blockIndex: 0\n            }, {\n                isBinding: true\n            })\n            .then(this.Transformer.Molecule.CreateModel, {\n                modelIndex: 0\n            }, {\n                isBinding: false,\n                ref: 'model'\n            })\n            .then(this.Transformer.Molecule.CreateMacromoleculeVisual, {\n                polymer: true,\n                polymerRef: 'polymer-visual',\n                het: true,\n                water: true\n            });\n\n        this\n            ._liteMol.applyTransform(transform).then(() => {\n                this._loaded = true;\n                this.highlightChain();\n            });\n    }\n\n    getTheme() {\n        let colors = new Map();\n        colors.set('Uniform', this.CoreVis.Color.fromRgb(207, 178, 178));\n        colors.set('Selection', this.CoreVis.Color.fromRgb(255, 255, 0));\n        colors.set('Highlight', this.CoreVis.Theme.Default.HighlightColor);\n        return this.Visualization.Molecule.uniformThemeProvider(void 0, {\n            colors: colors\n        });\n    }\n\n    processMapping(mappingData) {\n        if (!Object.values(mappingData)[0].UniProt[this.accession])\n            return;\n        return Object.values(mappingData)[0].UniProt[this.accession].mappings;\n    }\n\n    translatePositions(start, end) {\n        for (const mapping of this._selectedMolecule.mappings) {\n            if (mapping.unp_end - mapping.unp_start === mapping.end.residue_number - mapping.start.residue_number) {\n                if (start >= mapping.unp_start && end <= mapping.unp_end) {\n                    const offset = mapping.unp_start - mapping.start.residue_number;\n                    //TODO this is wrong because there are gaps in the PDB sequence\n                    return {\n                        entity: mapping.entity_id,\n                        chain: mapping.chain_id,\n                        start: (start - offset),\n                        end: (end - offset)\n                    }\n                } else {\n                    console.log('Positions not found in this structure');\n                    return;\n                }\n            } else {\n                console.log('Non-exact mapping');\n                return;\n            }\n        }\n    }\n\n    highlightChain() {\n        if (!this._loaded || !this._highlightstart || !this._highlightend)\n            return;\n\n        this.Command.Visual.ResetTheme.dispatch(this._liteMol.context, void 0);\n        this.Command.Tree.RemoveNode.dispatch(this._liteMol.context, 'sequence-selection');\n\n        const visual = this._liteMol.context.select('polymer-visual')[0];\n        if (!visual)\n            return;\n\n        const translatedPos = this.translatePositions(this._highlightstart, this._highlightend);\n        if (!translatedPos)\n            return;\n\n        const query = this.Query.sequence(translatedPos.entity.toString(), translatedPos.chain, {\n            seqNumber: translatedPos.start\n        }, {\n            seqNumber: translatedPos.end\n        });\n\n        const theme = this.getTheme();\n\n        const action = this._liteMol.createTransform()\n            .add(visual, this.Transformer.Molecule.CreateSelectionFromQuery, {\n                query: query,\n                name: 'My name'\n            }, {\n                ref: 'sequence-selection'\n            });\n\n        this._liteMol.applyTransform(action).then(() => {\n            this.Command.Visual.UpdateBasicTheme.dispatch(this._liteMol.context, {\n                visual: visual,\n                theme: theme\n            });\n            this.Command.Entity.Focus.dispatch(this._liteMol.context, this._liteMol.context.select('sequence-selection'));\n        });\n    }\n\n    _selectMoleculeWithinRange(start, end) {\n        if(! this._selectedMolecule)\n            return;\n        if (this._selectedMolecule.mappings.filter(d => d.unp_start <= start && d.unp_end >= end).length > 0) {\n            return;\n        }\n        const matches = this._pdbEntries.filter(d => d.properties.start <= start && d.properties.end >= end);\n        if (matches && matches.length > 0) {\n            this.selectMolecule(matches[0].id);\n        }\n\n    }\n\n    formatAngstrom(val) {\n        if (!val)\n            return;\n        return val.replace('A', '&#8491;');\n    }\n\n}\n\nexport default UuwLitemolComponent;","import UuwLitemolComponent from './uuw-litemol-component';\n\nconst loadComponent = function () {\n    customElements.define('uuw-litemol-component', UuwLitemolComponent);\n}\n\n// Conditional loading of polyfill\nif (window.customElements) {\n    loadComponent();\n} else {\n    document\n        .addEventListener('WebComponentsReady', function () {\n            loadComponent();\n        });\n}"],"names":["UuwLitemolComponent","_loaded","_mappings","_highlightstart","parseInt","getAttribute","_highlightend","loadMolecule","bind","loadStructureTable","titleContainer","document","createElement","id","tableDiv","className","litemolDiv","appendChild","loadLiteMol","loadUniProtEntry","then","_pdbEntries","entry","dbReferences","filter","dbref","type","map","d","properties","method","getChain","chains","getStart","getEnd","selectMolecule","attrName","oldVal","newVal","value","isNaN","_selectMoleculeWithinRange","highlightChain","fetch","accession","json","Error","pdbId","html","formatAngstrom","resolution","start","end","join","innerHTML","querySelectorAll","forEach","row","addEventListener","e","replace","split","loadPDBEntry","mappings","processMapping","_selectedMolecule","classList","remove","querySelector","add","textContent","Plugin","LiteMol","Command","Bootstrap","Query","Core","Structure","Tree","CoreVis","Visualization","Transformer","Entity","Event","_liteMol","create","_id","clear","transform","createTransform","root","Data","Download","toLowerCase","ParseBinaryCif","Molecule","CreateFromMmCif","CreateModel","CreateMacromoleculeVisual","applyTransform","colors","Map","set","Color","fromRgb","Theme","Default","HighlightColor","uniformThemeProvider","mappingData","Object","values","UniProt","mapping","unp_end","unp_start","residue_number","offset","entity_id","chain_id","log","Visual","ResetTheme","dispatch","context","RemoveNode","visual","select","translatedPos","translatePositions","query","sequence","entity","toString","chain","theme","getTheme","action","CreateSelectionFromQuery","UpdateBasicTheme","Focus","length","matches","val","setAttribute","HTMLElement","loadComponent","define","window","customElements"],"mappings":"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"}