{"version":3,"file":"uuw-litemol-component.js","sources":["../src/main.js"],"sourcesContent":["const loadComponent = function () {\n    class UuwLitemolComponent extends HTMLElement {\n\n        constructor() {\n            super();\n            // We can't use the shadow DOM as the LiteMol component interacts with the\n            // document DOM.\n            this.loadMolecule = this\n                .loadMolecule\n                .bind(this);\n            this.loadStructureTable = this\n                .loadStructureTable\n                .bind(this);\n            const styleTag = document.createElement('style');\n            this.appendChild(styleTag);\n            styleTag.innerHTML = `\n                :root {\n                    --blue: 0,112,155;\n                    --width: 100%;\n                }\n                uuw-litemol-component {\n                    display:flex;\n                }\n                .litemol-container, .table-container {\n                    width: var(--width);\n                    height: 480px;\n                    position: relative;\n                }\n                .table-container table {\n                    width:100%;\n                    height: 480px;\n                    border-collapse: collapse;\n                }\n                .table-container thead {\n                    min-height: 3em;\n                  }\n                  \n                .table-container th, .table-container td {\n                    box-sizing: border-box;\n                    flex: 1 0 5em;\n                    overflow: hidden;\n                    text-overflow: ellipsis;\n                }\n                .table-container table, .table-container thead, .table-container tbody, .table-container tfoot {\n                    display: flex;\n                    flex-direction: column;\n                }\n                .table-container tr {\n                    display: flex;\n                    flex: 1 0;\n                }\n                .table-container tbody {\n                    overflow-y: auto;\n                }\n                .table-container tbody tr {\n                    cursor: pointer;\n                }\n                .table-container tbody tr:hover {\n                    background-color: rgba(var(--blue), 0.15);;\n                }\n                .table-container tr.active {\n                    background-color: rgba(var(--blue), 0.3);;\n                }\n            `;\n        }\n\n        getAccession() {\n            return this.getAttribute('accession');\n        }\n\n        setAccession(accession) {\n            return this.setAttribute('accession', accession);\n        }\n\n        connectedCallback() {\n            this.titleContainer = document.createElement('h4');\n            this.titleContainer.id = 'litemol-title';\n            this.tableDiv = document.createElement('div');\n            this.tableDiv.className = 'table-container';\n            const litemolDiv = document.createElement('div');\n            litemolDiv.className = 'litemol-container';\n            litemolDiv.id = 'app';\n            this.appendChild(this.titleContainer);\n            this.appendChild(litemolDiv);\n            this.appendChild(this.tableDiv);\n            this.loadLiteMol();\n            this\n                .loadEntry()\n                .then(entry => {\n                    const pdbEntries = entry\n                        .dbReferences\n                        .filter(dbref => dbref.type === 'PDB');\n                    this.loadStructureTable(pdbEntries);\n                    this.selectMolecule(pdbEntries[0].id);\n                });\n        }\n\n        attributeChangedCallback(attrName, oldVal, newVal) {\n            console.log('changed', attrName);\n        }\n\n        async loadEntry() {\n            try {\n                return await (await fetch(`https://www.ebi.ac.uk/proteins/api/proteins/${this.getAccession()}`)).json();\n            } catch (e) {\n                console.log(`Couldn't load UniProt entry`, e);\n            }\n        }\n\n        loadStructureTable(pdbEntries) {\n            const html = `\n                <table>\n                    <colgroup>\n                        <col syle=\"width: 100px\">\n                        <col syle=\"width: 100px\">\n                        <col syle=\"width: 100px\">\n                        <col syle=\"width: 100px\">\n                        <col syle=\"width: auto\">\n                    </colgroup>\n                    <thead><th>PDB Entry</th><th>Method</th><th>Resolution</th><th>Chain</th><th>Positions</th></thead>\n                    <tbody>\n                        ${pdbEntries\n                .map(d => `\n                            <tr id=\"${d.id}\" class=\"pdb-row\">\n                                <td>\n                                <strong>${d.id}</strong><br/>\n                                <a target=\"_blank\" href=\"//www.ebi.ac.uk/pdbe/entry/pdb/${d.id}\">PDB</a> \n                                <a target=\"_blank\" href=\"//www.rcsb.org/pdb/explore/explore.do?pdbId=${d.id}\">RCSB-PDBi</a>\n                                <a target=\"_blank\" href=\"//pdbj.org/mine/summary/${d.id}\">PDBj</a>\n                                <a target=\"_blank\" href=\"//www.ebi.ac.uk/thornton-srv/databases/cgi-bin/pdbsum/GetPage.pl?pdbcode=${d.id}\">PDBSUM</a>\n                                </td>\n                                <td>${d.properties.method}</td>\n                                <td>${d.properties.resolution}</td>\n                                <td title=\"${this.getChain(d.properties.chains)}\">${this.getChain(d.properties.chains)}</td>\n                                <td>${this.getPositions(d.properties.chains)}</td>\n                            </tr>\n                        `)\n                .join('')}\n                    </tbody>\n                </table>\n            `;\n            this.tableDiv.innerHTML = html;\n            this\n                .querySelectorAll('.pdb-row')\n                .forEach(row => row.addEventListener('click', (e) => this.selectMolecule(row.id)));\n        }\n\n        getChain(chains) {\n            return chains.split('=')[0];\n        }\n\n        getPositions(chains) {\n            return chains.split('=')[1];\n        }\n\n        selectMolecule(id) {\n            this\n                .querySelectorAll('.active')\n                .forEach(row => row.classList.remove('active'));\n            document\n                .getElementById(id)\n                .classList\n                .add('active');\n            document.getElementById('litemol-title').textContent = id;\n            this.loadMolecule(id);\n        }\n\n        loadLiteMol() {\n            const Plugin = LiteMol.Plugin;\n            this.Command = LiteMol.Bootstrap.Command;\n            this.Query = LiteMol.Core.Structure.Query;\n            this.Bootstrap = LiteMol.Bootstrap;\n            this.Core = LiteMol.Core;\n            this.CoreVis = LiteMol.Visualization;\n            this.Transformer = this.Bootstrap.Entity.Transformer;\n            this.Visualization = this.Bootstrap.Visualization;\n            // Plugin.Components.Context.Log(LayoutRegion.Bottom, true),\n            this._liteMol = Plugin.create({\n                target: '#app',\n                viewportBackground: '#fff',\n                layoutState: {\n                    hideControls: true\n                },\n                allowAnalytics: false\n            });\n        }\n\n        loadMolecule(_id) {\n            this\n                ._liteMol\n                .clear();\n\n            let transform = this._liteMol.createTransform();\n\n            transform.add(this\n                ._liteMol.root, this.Transformer.Data.Download, {\n                    url: `https://www.ebi.ac.uk/pdbe/coordinates/${_id.toLowerCase()}/full?encoding=BCIF`,\n                    type: 'Binary',\n                    _id\n                })\n                .then(this.Transformer.Data.ParseBinaryCif, { id: _id }, { isBinding: true, ref: 'cifDict' })\n                .then(this.Transformer.Molecule.CreateFromMmCif, { blockIndex: 0 }, { isBinding: true })\n                .then(this.Transformer.Molecule.CreateModel, { modelIndex: 0 }, { isBinding: false, ref: 'model' })\n                .then(this.Transformer.Molecule.CreateMacromoleculeVisual, { polymer: true, polymerRef: 'polymer-visual', het: true, water: true });\n\n            this\n                ._liteMol.applyTransform(transform);\n\n            setTimeout(() => this.highlightChain(), 3000);\n\n        }\n\n        getTheme() {\n            let colors = new Map();\n            colors.set('Uniform', this.CoreVis.Color.fromRgb(207,178,178));\n            colors.set('Selection', this.CoreVis.Color.fromRgb(0,81,51));\n            colors.set('Highlight', this.CoreVis.Theme.Default.HighlightColor);\n            return this.Visualization.Molecule.uniformThemeProvider(void 0, { colors: colors });\n        }\n\n        highlightChain() {\n            console.log('highlighting', this._liteMol.context.select('polymer-visual')[0]);\n            const visual = this._liteMol.context.select('polymer-visual')[0];\n            if (!visual)\n                return;\n\n            const query = this.Query.sequence(1, 'A', {\n                seqNumber: 10\n            }, {\n                seqNumber: 40\n            });\n\n            const theme = this.getTheme();\n\n            const action = this._liteMol.createTransform()\n                .add(visual, this.Transformer.Molecule.CreateSelectionFromQuery, { query: query, name: 'My name' }, { ref: 'sequence-selection' });\n\n            action.then(this.Transformer.Molecule.CreateVisual, { style: this.Visualization.Molecule.Default.ForType.get('BallsAndSticks') });\n\n            this._liteMol.applyTransform(action).then(() => {\n                console.log(theme);\n                this.Command.Visual.UpdateBasicTheme.dispatch(this._liteMol.context, { visual: visual, theme: theme });\n                this.Command.Entity.Focus.dispatch(this._liteMol.context, this._liteMol.context.select('sequence-selection'));\n            });\n        }\n\n    }\n    customElements.define('uuw-litemol-component', UuwLitemolComponent);\n}\n\n// Conditional loading of polyfill\nif (window.customElements) {\n    loadComponent();\n} else {\n    document\n        .addEventListener('WebComponentsReady', function () {\n            loadComponent();\n        });\n}"],"names":["loadComponent","UuwLitemolComponent","loadMolecule","bind","loadStructureTable","styleTag","document","createElement","appendChild","innerHTML","getAttribute","accession","setAttribute","titleContainer","id","tableDiv","className","litemolDiv","loadLiteMol","loadEntry","then","pdbEntries","entry","dbReferences","filter","dbref","type","selectMolecule","attrName","oldVal","newVal","log","fetch","getAccession","json","html","map","d","properties","method","resolution","getChain","chains","getPositions","join","querySelectorAll","forEach","row","addEventListener","e","split","classList","remove","getElementById","add","textContent","Plugin","LiteMol","Command","Bootstrap","Query","Core","Structure","CoreVis","Visualization","Transformer","Entity","_liteMol","create","_id","clear","transform","createTransform","root","Data","Download","toLowerCase","ParseBinaryCif","isBinding","ref","Molecule","CreateFromMmCif","blockIndex","CreateModel","modelIndex","CreateMacromoleculeVisual","polymer","polymerRef","het","water","applyTransform","highlightChain","colors","Map","set","Color","fromRgb","Theme","Default","HighlightColor","uniformThemeProvider","context","select","visual","query","sequence","theme","getTheme","action","CreateSelectionFromQuery","name","CreateVisual","style","ForType","get","Visual","UpdateBasicTheme","dispatch","Focus","HTMLElement","define","window","customElements"],"mappings":"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"}